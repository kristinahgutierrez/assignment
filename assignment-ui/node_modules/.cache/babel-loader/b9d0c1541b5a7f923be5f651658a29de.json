{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar api_1 = __importDefault(require(\"@aws-amplify/api\"));\n\nvar auth_1 = require(\"@aws-amplify/auth\");\n\nvar core_1 = require(\"@aws-amplify/core\");\n\nvar datastore_1 = require(\"@aws-amplify/datastore\"); // ! We have to use this exact reference, since it gets mutated with Amplify.Auth\n\n\nvar index_1 = require(\"./index\");\n\nvar requiredModules = [// API cannot function without Auth\nauth_1.Auth, // Auth cannot function without Credentials\ncore_1.Credentials]; // These modules have been tested with SSR\n\nvar defaultModules = [api_1.default, auth_1.Auth, datastore_1.DataStore];\n\nfunction withSSRContext(context) {\n  if (context === void 0) {\n    context = {};\n  }\n\n  var _a = context.modules,\n      modules = _a === void 0 ? defaultModules : _a,\n      req = context.req;\n  var previousConfig = index_1.Amplify.configure();\n  var amplify = new core_1.AmplifyClass();\n  var storage = new core_1.UniversalStorage({\n    req: req\n  });\n  requiredModules.forEach(function (m) {\n    if (!modules.includes(m)) {\n      // @ts-ignore This expression is not constructable.\n      // Type 'Function' has no construct signatures.ts(2351)\n      amplify.register(new m.constructor());\n    }\n  }); // Associate new module instances with this amplify\n\n  modules.forEach(function (m) {\n    amplify.register(new m.constructor());\n  }); // Configure new Amplify instances with previous configuration\n\n  amplify.configure(__assign(__assign({}, previousConfig), {\n    storage: storage\n  }));\n  return amplify;\n}\n\nexports.withSSRContext = withSSRContext;","map":{"version":3,"sources":["../src/withSSRContext.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,KAAA,GAAA,eAAA,CAAA,OAAA,CAAA,kBAAA,CAAA,CAAA;;AACA,IAAA,MAAA,GAAA,OAAA,CAAA,mBAAA,CAAA;;AACA,IAAA,MAAA,GAAA,OAAA,CAAA,mBAAA,CAAA;;AACA,IAAA,WAAA,GAAA,OAAA,CAAA,wBAAA,CAAA,C,CAEA;;;AACA,IAAA,OAAA,GAAA,OAAA,CAAA,SAAA,CAAA;;AAEA,IAAM,eAAe,GAAG,CACvB;AACA,MAAA,CAAA,IAFuB,EAGvB;AACA,MAAA,CAAA,WAJuB,CAAxB,C,CAOA;;AACA,IAAM,cAAc,GAAG,CAAC,KAAA,CAAA,OAAD,EAAM,MAAA,CAAA,IAAN,EAAY,WAAA,CAAA,SAAZ,CAAvB;;AAOA,SAAgB,cAAhB,CAA+B,OAA/B,EAAoD;AAArB,MAAA,OAAA,KAAA,KAAA,CAAA,EAAA;AAAA,IAAA,OAAA,GAAA,EAAA;AAAqB;;AAC3C,MAAA,EAAA,GAAA,OAAA,CAAA,OAAA;AAAA,MAAA,OAAA,GAAA,EAAA,KAAA,KAAA,CAAA,GAAA,cAAA,GAAA,EAAA;AAAA,MAA0B,GAAA,GAAA,OAAA,CAAA,GAA1B;AACR,MAAM,cAAc,GAAG,OAAA,CAAA,OAAA,CAAQ,SAAR,EAAvB;AACA,MAAM,OAAO,GAAG,IAAI,MAAA,CAAA,YAAJ,EAAhB;AACA,MAAM,OAAO,GAAG,IAAI,MAAA,CAAA,gBAAJ,CAAqB;AAAE,IAAA,GAAG,EAAA;AAAL,GAArB,CAAhB;AAEA,EAAA,eAAe,CAAC,OAAhB,CAAwB,UAAA,CAAA,EAAC;AACxB,QAAI,CAAC,OAAO,CAAC,QAAR,CAAiB,CAAjB,CAAL,EAA0B;AACzB;AACA;AACA,MAAA,OAAO,CAAC,QAAR,CAAiB,IAAI,CAAC,CAAC,WAAN,EAAjB;AACA;AACD,GAND,EANmD,CAcnD;;AACA,EAAA,OAAO,CAAC,OAAR,CAAgB,UAAA,CAAA,EAAC;AAChB,IAAA,OAAO,CAAC,QAAR,CAAiB,IAAI,CAAC,CAAC,WAAN,EAAjB;AACA,GAFD,EAfmD,CAmBnD;;AACA,EAAA,OAAO,CAAC,SAAR,CAAiB,QAAA,CAAA,QAAA,CAAA,EAAA,EAAM,cAAN,CAAA,EAAoB;AAAE,IAAA,OAAO,EAAA;AAAT,GAApB,CAAjB;AAEA,SAAO,OAAP;AACA;;AAvBD,OAAA,CAAA,cAAA,GAAA,cAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar api_1 = __importDefault(require(\"@aws-amplify/api\"));\nvar auth_1 = require(\"@aws-amplify/auth\");\nvar core_1 = require(\"@aws-amplify/core\");\nvar datastore_1 = require(\"@aws-amplify/datastore\");\n// ! We have to use this exact reference, since it gets mutated with Amplify.Auth\nvar index_1 = require(\"./index\");\nvar requiredModules = [\n    // API cannot function without Auth\n    auth_1.Auth,\n    // Auth cannot function without Credentials\n    core_1.Credentials,\n];\n// These modules have been tested with SSR\nvar defaultModules = [api_1.default, auth_1.Auth, datastore_1.DataStore];\nfunction withSSRContext(context) {\n    if (context === void 0) { context = {}; }\n    var _a = context.modules, modules = _a === void 0 ? defaultModules : _a, req = context.req;\n    var previousConfig = index_1.Amplify.configure();\n    var amplify = new core_1.AmplifyClass();\n    var storage = new core_1.UniversalStorage({ req: req });\n    requiredModules.forEach(function (m) {\n        if (!modules.includes(m)) {\n            // @ts-ignore This expression is not constructable.\n            // Type 'Function' has no construct signatures.ts(2351)\n            amplify.register(new m.constructor());\n        }\n    });\n    // Associate new module instances with this amplify\n    modules.forEach(function (m) {\n        amplify.register(new m.constructor());\n    });\n    // Configure new Amplify instances with previous configuration\n    amplify.configure(__assign(__assign({}, previousConfig), { storage: storage }));\n    return amplify;\n}\nexports.withSSRContext = withSSRContext;\n//# sourceMappingURL=withSSRContext.js.map"]},"metadata":{},"sourceType":"script"}